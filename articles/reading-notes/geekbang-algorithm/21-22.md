# 21 哈希算法
## 定义

> 将任意长度的二进制值映射为固定长度的二进制值串的规则称为**哈希算法**, 映射之后得到的值就是**哈希值**

## 要求

1. 从哈希值不能反向推导出原始数据
2. 对输入数据敏感，原始数据较小的修改也会造成哈希值的大不相同
3. 散列冲突的概率要很小
4. 算法的执行效率要尽快高效，针对长文本也能快速计算哈希值

## 应用
### 安全

应用于安全领域主要是因为一下两点
1. 很难根据哈希值反向推导出原始数据
2. 散列冲突的概率很小

#### 为什么无法避免哈希冲突

> 鸽巢原理：如果有 10 个鸽笼要放 11 只鸽子， 这样可定会有 2 只鸽子放在同 1 个鸽笼里。

对应于哈希函数来说（以 MD5 举例）
- 哈希值是固定 128 位二进制串，最多表示 2^128 个数据
- 要进行哈希的数据是无穷的

因此肯定会存在哈希冲突。但是出现的概率小于 1/2^128

### 唯一标识

检索图片的方式
1. 直接对比图片的二进制，速度太慢
2. 根据图片的二进制计算哈希值，然后比较哈希值，对于较大的图片来说依然非常耗时
3. 根据图片的二进制的信息摘要(比如在开头，中间，尾部各取 100 字节，然后计算哈希值)，能减少很多工作量

### 数据校验

通过哈希算法对文件分别取哈希值保存到种子文件中，下载完成后根据相同的哈希算法计算哈希值，如果不同就说明数据不对

### 散列函数

散列函数对哈希冲突的要求要低很多，对于反向解密也不关心。更注重散列后的值能否平均分布，以及函数的效率

## QA

### 如何存储用户的密码

1. 选择安全的加密算法
2. 可以引入 salt ，通过对原始数据加盐增加密码的复杂度，增加破解难度
3. 利用特殊的算法 PBKDF2WithHmacSHA1 ，这种算法如无论密码长度多少，它计算字符串hash时间都是固定或者足够慢的。这样就降低了硬件计算hash速度，减少不同长度字符串计算hash所需时间不一样而泄漏字符串长度信息，进一步减少风险。

### 区块链的加密方式

区块链是一块块区块组成的，每个区块分为两部分：区块头和区块体。

区块头保存着 自己区块体 和 上一个区块头 的哈希值。

因为这种链式关系和哈希值的唯一性，只要区块链上任意一个区块被修改过，后面所有区块保存的哈希值就不对了。

区块链使用的是 SHA256 哈希算法，计算哈希值非常耗时，如果要篡改一个区块，就必须重新计算该区块后面所有的区块的哈希值，短时间内几乎不可能做到。

